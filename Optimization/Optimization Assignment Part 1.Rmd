---
title: "Optimization"
author: "Efthymios Ioannis Kavour"
date: '2022-06-24'
output: 
  pdf_document: 
    latex_engine: xelatex
    extra_dependencies: ["mathtools"]
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{cat, engine.opts = list(file = "header.tex")}
\renewcommand{\linethickness}{0.05em}
```

```{r}
library(latex2exp)
library(lpSolve)
library(lpSolveAPI)
```

### \underline{Exercise 1}:

Assume that :

$$
A = \begin{bmatrix}
3   &  0    &  3 \\
0   &  1    & -2 \\
3   & -2    &  8 \\
\end{bmatrix}
\quad 
B = \begin{bmatrix}
 2  & -1  &  b   \\
-1  &  2  & -1   \\
 b  & -1  &  2   \\
\end{bmatrix}
$$

Is $\textbf{A}$ positively definite? Are there values of $\textit{b}$
that matrix $\textbf{B}$ is positively definite? If yes what are those
values?

### \underline{Solution}:

We know that a symmetrical matrix $M_{k\times k}\quad k =1,\dots,n$ is
positively definite if

1.  All the eigen values are positive.
2.  All the $\textit{n}$ upper left determinants of a $M_{k\times k}$
    are positive
3.  All the drivers $d_i,\quad\forall i = 1,\dots,n$ in the Gaussian
    Elimination without interchanging of lines are positive.\

In order to check whether $A$ is positive definite, we are going to
calculate all the upper left determinants. As a result we have the
following observations. The first term $m_{1\times 1}$ is positive.

$$
3 > 0
$$

Furthermore, we can see that the next $\textit{left-upper}$ determinant
is the determinant of the $2\times 2$ submatrix, as shown below, which
is positive as well.

$$
\begin{vmatrix}
3 & 0 \\
0 & 1
\end{vmatrix} = 3 > 0
$$ Finally what is left is the determinant of the full $3\times 3$
matrix $A$ which as shown below, positive.

$$
\begin{vmatrix}
3   &  0    &  3    \\
0   &  1    & -2    \\
3   & -2    &  8    
\end{vmatrix} = \\
$$ $$
3\cdot1\cdot8+0\cdot(-2)\cdot3+3\cdot0\cdot(-2)-3\cdot1\cdot3-(-2)\cdot(-2)\cdot3-8\cdot0\cdot0=\\
$$

$$
24+0+0-9-12-0=3>0
$$

In conclusion, we can see that matrix $A$ is $\textbf{positive define}$.
We are going to follow the exact same methodology in order to answer to
the second part of this exercise. Initially we observe that $2>0$ and as
a result we move forward and calculate the next determinant of the
upper-left submatrix $M_{2\times2}$.

$$
\begin{vmatrix}
 2 &  -1 \\
-1 & 2 
\end{vmatrix} = 2\cdot 2 - (-1)\cdot (-1)= 4 - 1 = 3 >0
$$ The determinant of the submatrix is a positive number. What is left
is to calculate the determinant of the full initial matrix, containing
the unknown $b$. What we need is $B$ to be a positive definite. This
means that:

$$
\begin{vmatrix}
 2  & -1  &  b   \\
-1  &  2  & -1   \\
 b  & -1  &  2  
\end{vmatrix}=
$$

$$
2\cdot 2\cdot 2 + (-1)\cdot (-1)\cdot b + b\cdot (-1)\cdot (-1) - b \cdot 2\cdot b- (-1)\cdot (-1)\cdot 2 - 2 \cdot (-1)\cdot (-1)=
$$

$$
8+b+b-2b^2-2-2=-2b^2+2b+4
$$

As a result we have to find all those $b$ that the equation we ended up.
If we follow the usual steps of solving a second order equation we have
that:

$$
−2b^2+2b+4=2(−b−1)(b−2)
$$ which means that the $b$ that make this equation equal to zero are
$b=-1$ and $b=2$. We know that the equation is going to be positive
$\forall b \in (-1,2)$ and negative
$\forall b \in (-\infty,-1)\cup(2,\infty)$. This is something one can
observe in the following graph.

```{r}
f1 <- function(x){
        return(-2*x^2+2*x+4)
}

curve(expr = f1, from = -2, to = 3)
points(x = c(-1,2), y = c(0,0), col = 'red')
abline(h = 0, lty = 2, col = 'red')
title(main = TeX(r'(\textbf{Equation} : $-2x^2+2x+4$)'))
```

As a result the solution is the following $$
B\text{ positive-definite} \Leftrightarrow \forall b \in (-1,2)
$$

------------------------------------------------------------------------

### \underline{Exercise 2}:

Find all the critical points and say whether they are local minimum,
local maximum or saddle points, of the following functions:

$$
f(x,y)=x^2+2y^2-x
$$ $$
g(x,y)=x^3+y^3-9xy+27
$$ $$
h(x,y)=2x^3+y^3-3x^2y-6y
$$

### \underline{Solution}:

We know that a point $(x^*,y^*)$ is critical if
$\bigtriangledown f(x^*,y^*)=(0,0)$. After finding a critical point, we
can check whether the Hessian Matrix at this point is positive definite
or negative definite. If the matrix is positive definite then the point
is local minimum. On the other hand, if the Hessian Matrix is negative
definite, then it is local maximum. Now we can start by finging the
partial derivative in order to find out the critical point(s)

$$
\partial_xf(x,y) = 2x - 1\quad\text{and}\quad\partial_yf(x,y) = 4y
$$

One can easily check that

$$
\partial_xf(x,y) = 0 \Leftrightarrow x =\frac{1}{2}
$$ $$
\partial_yf(x,y) = 0 \Leftrightarrow y = 0
$$

So function $f$ has one critical point $(x^*,y^*)=(\frac{1}{2},0)$.
Moving forward we have to calculate the Hessian matrix in order to check
whether the point is local minimum, local maximum or saddle point.We
know that

$$
\begin{bmatrix}
\partial_{x^2}^2f(x,y) & \partial_{xy}^2f(x,y)\\
\partial_{yx}^2f(x,y) & \partial_{y^2}^2f(x,y)
\end{bmatrix} = \begin{bmatrix}
2 & 0 \\
0 & 4
\end{bmatrix}
$$

We can easily see that this is a positive definite matrix and as a
result the critical point is local minimum. Moving on we have function
$g(x,y)$.

$$
\partial_xg(x,y) = 3x^2 - 9y\quad\text{and}\quad\partial_yf(x,y) = 3y^2 -9x
$$

We can solve the equations above like a system, meaning:

$$
\begin{cases}
3x^2 - 9y = 0 \\
3y^2 -9x = 0
\end{cases} \Rightarrow
\begin{cases}
x^2 - 3y = 0 \\
y^2 - 3x = 0
\end{cases} \Rightarrow
\begin{cases}
y = \frac{x^2}{3}\\
y^2 - 3x = 0
\end{cases}\Rightarrow
$$ $$
(\frac{x^2}{3})^2-3x=0\Rightarrow x^4-27x=0 \Rightarrow x(x^3-27)=0 \Rightarrow
$$ $$
x = 0\quad \text{or}\quad x^3 = 27 \Rightarrow
$$ $$
x = 0 \quad \text{or}\quad x = \sqrt[3]{27} \Rightarrow
$$ $$
x=0 \quad \text{or} \quad x = 3
$$

Let's assume that $x = 0$ then by inserting this in the next equation we
have that $y = 0$. So we have the first critical point which is
$(x^*_1,y^*_2) = (0,0)$.\
On the other hand, let's assume that $x=3$, then we can see that
$y = 3$. By those steps, we ended up in a second critical point which is
$(x_2^*,y_2^*)=(3,3)$. In order to check and identify what kind of
critical points those are, we need to calculate the Hessian determinant
in the points we just found. The Hessian matrix can be calculated as
follows:

$$
H(x^*,y^*)=\begin{vmatrix}
\partial^2_{x^2} g(x^*,y^*) & \partial_{xy}^2g(x^*,y^*) \\
\partial_{yx}^2g(x^*,y^*) & \partial^2_{y^2} g(x^*,y^*)
\end{vmatrix}=
\begin{vmatrix}
6x^* & -9 \\
-9 & 6y^*
\end{vmatrix}
$$ So for the first critical point, we have the following result

$$
H(0,0)= \begin{vmatrix}
0 & -9\\
-9 & 0
\end{vmatrix}=0\cdot0 -(-9)\cdot(-9)=-81 <0
$$

We ended up that $H(0,0)<0$ meaning that this is a local maximum poitn.
Now let us move forward and chech the secotn critical point.

$$
H(3,3)=\begin{vmatrix}
6\cdot3 & -9\\
-9 & 6\cdot3
\end{vmatrix}= \begin{vmatrix}
18 & -9 \\
-9 & 18
\end{vmatrix} =324 -81 = 243 >0
$$

As we can see, $H(3,3) = 243$ is greater than zero. This implies that
the critical point is local minimum. The last but not least function is

$$h(x,y)=2x^3+y^3-3x^2y-6y$$

As you may have already thought, we are going to follow the exact same
methodology.

$$
\partial_xh(x,y)=6x^2-6xy\quad \text{and}\quad \partial_yh(x,y)= 3y^2-3x^2-6
$$

In order to find the critical points, we solve the following system.

$$
\begin{cases}
6x^2-6xy = 0\\
3y^2-3x^2-6 = 0
\end{cases} \Rightarrow
\begin{cases}
6x(x-y)=0\\
3y^2-3x^2-6 = 0
\end{cases}\Rightarrow
$$

From the first equation we have that $6x=0\Rightarrow x=0$ or $x=y$.

Initially, let us assume that $x=0$ from the second equation we have
that

$$
3y^2-6 = 0 \Leftrightarrow y^2 -2 = 0 \Leftrightarrow y =\pm\sqrt2
$$

Which implies that the critical points obtained are
$(x_1^*, y_1^*)=(0,\sqrt2)$ and $(x_2^*, y_2^*)=(0,-\sqrt2)$. Now let us
assume that $y = x$ and use this information in the second equation, we
have that

$$
3x^2 - 3x^2 -6 =0 \Leftrightarrow -6 = 0
$$

Which is a not possible result. In order to continue and describe the
kind of the critical points we have found $(x^*, y^*)=(0,\pm\sqrt2)$ we
have to define the Hessian matrix and calculate its determinant for each
of the critical point.

$$
H(x^*,y^*)=\begin{vmatrix}
\partial^2_{x^2}h(x^*,y^*) & \partial_{xy}^2h(x^*,y^*)\\
\partial_{yx}^2h(x^*,y^*) & \partial^2_{y^2}h(x^*,y^*)
\end{vmatrix} = \begin{vmatrix}
12x-6y & -6x \\
-6x & 6y
\end{vmatrix}
$$

So moving forward to calculating the Hessian matrix of the critical
points we have the following calculations

$$
H(0,\sqrt2) = \begin{vmatrix}
12\cdot0-6\cdot\sqrt2 & -6\cdot0 \\
-6\cdot0 & 6\cdot\sqrt2
\end{vmatrix}=\begin{vmatrix}
-6\sqrt2 & 0\\
0 & 6\sqrt2
\end{vmatrix}= -72 <0
$$

We ended up that $H(0,\sqrt2)=-72<0$ which implies that the critical
point is local maximum. On the other hand we have that

$$
H(0,-\sqrt2) = \begin{vmatrix}
12\cdot0-6\cdot-\sqrt2 & -6\cdot0 \\
-6\cdot0 & 6\cdot-\sqrt2
\end{vmatrix}=\begin{vmatrix}
6\sqrt2 & 0\\
0 & -6\sqrt2
\end{vmatrix}= -72 <0
$$ Again as the previous critical point we see that the determinant of
$H(x_2^*,y_2^*)$ results to $-72$ which less than zero and this implies
that the critical point is a local maximum as well.

------------------------------------------------------------------------

### \underline{Exercise 3}:

Find all the extreme values of the functions

a.  $f(x,y,z)=x^2+y^2+z^2+4yz$ under the constraint that $x+y+z=0$ and
    $x+y=1$ with the method of Lagrange multipliers\
b.  $f(x_1,x_2,x_3)=2x_1^2-3x_1x_2+x_2^2+x_1x_3-2x_2x_3+3x_3^2$ under
    the constraint that $x_1+x_2-x_3 = 0$

Figure out if the point is minimal, maximal or a saddle point.

### \underline{Solution}:

Lagrange multipliers are used to help us solve constrained optimization
problems, as we have to face in this exercise. The basic structure of a
Lagrange multiplier problem with one constraint and two variables $x,y$
is the following:

$$
\mathcal{L}(x,y;\lambda) = f(x,y) + \lambda g(x,y)
$$

where $f(x,y)$ is the function to optimize under the constraint
$g(x,y)$, and $\lambda$ is the Lagrange multiplier. In the next step, we
set $\nabla\mathcal{L}=\nabla f +\lambda\nabla g=0$ to solve the
resulting system of equations. In our case we have the following:

$$
\mathcal{L}(x,y,z;\lambda_1,\lambda_2) = f(x,y,z) + \lambda_1 g_1(x,y,z) +\lambda_2g_2(x,y,z)\Leftrightarrow
$$ $$
\mathcal{L}(x,y,z;\lambda_1,\lambda_2) = x^2+y^2+z^2+4yz +\lambda_1(x+y+z) +\lambda_2(x+y-1)
$$

The partial derivatives of the Lagrange

$$
\nabla\mathcal{L}(x,y,z;\lambda_1,\lambda_2) = \nabla f(x,y,z) = \lambda_1 \nabla g_1(x,y,z) + \lambda_2 \nabla g_2(x,y,z)
$$ results in the following system of equations

$$
\begin{cases}
  \nabla_x \mathcal{L}=0 \\
  \nabla_y \mathcal{L}=0 \\
  \nabla_z \mathcal{L}=0 \\
  g_1(x,y,z)=0 \\
  g_2(x,y,z)=0
\end{cases} \Rightarrow \begin{cases}
  2x+\lambda_1+\lambda_2=0 \\
  2y+4z+\lambda_1+\lambda_2=0 \\
  2z+4y+\lambda_1 = 0 \\
  x+y+z=0\\
  x+y-1=0
\end{cases} \Rightarrow 
$$ $$
\begin{cases}
\lambda_2=-2x-2z-4y\\
2y+4z+\lambda_1+\lambda_2=0\\
\lambda_1=-2z-4y\\
x+y+z=0\\
x+y=1
\end{cases}
$$

combining the first three equations, we end up

$$
\begin{cases}
-6y-2x=0 \\
x+y+z=0 \\
x+y=1
\end{cases}
$$ By solving the last system of equations we end up in the solution

$$
(x^*,y^*,z^* )= (\frac{3}{2}, -\frac{1}{2},-1)
$$

In order to figure out whether this point is minimum, maximum or a
saddle point, we can use the determinant of the Hessian matrix.

$$
H(x^*,y^*,z^*) = \begin{bmatrix}
\partial_{x^2}^2f & \partial_{xy}^2f & \partial_{xz}^2f\\
\partial_{yx}^2f & \partial_{y^2}^2f & \partial_{yz}^2f \\
\partial_{zx}^2f & \partial_{zy}^2f & \partial_{z^2}^2f \\
\end{bmatrix}
$$

We already, have calculated that:

$$
\partial_x(f)(x,y,z) = 2x,\quad \partial\partial_y(f)(x,y,z) = 2y+4z,\quad \partial\partial_z(f)(x,y,z) = 2z+4y
$$

Moving forward we have that:

$$
|H(x^*,y^*,z^*)| = \begin{vmatrix}
2 & 0 & 0\\
0 & 2 & 4 \\
0 & 4 & 2 \\
\end{vmatrix}
$$

All we now to do is to calculate all the upper-left determinants. We can
see that the first argument at posision $1\times1$ is $2>0$. Then as a
second step, we need to check the determinant of the submatrix
$H_{2\times2}\subset H_{3\times3}$. Hence we see that

$$
\begin{vmatrix}
2 & 0 \\
0 & 2
\end{vmatrix} = 2\cdot 2 -0\cdot 0 = 4 >0
$$

We see that the determinant is positive as well. Finally, we have that

$$
|H(x^*,y^*,z^*)| = \begin{vmatrix}
2 & 0 & 0\\
0 & 2 & 4 \\
0 & 4 & 2 \\
\end{vmatrix} = 
$$ $$
2\cdot2\cdot2+0\cdot4\cdot0+0\cdot0\cdot4-0\cdot2\cdot0-4\cdot4\cdot2-2\cdot0\cdot0=4-32 =-28<0
$$

As we see, the determinant of the full Hessian matrix is negative. This
implies that the Hessian matrix is negative definite and as a result,
the point is maximum.

Moving forward to the second part of the exercise we have the following
constrained problem.

$$
2x_1^2 − 3x_1x_2 + x_2^2 +x_1x_3 − 2x_2x_3 +3x_3^2
$$ under the constraint $$
x_1 +x_2 −x_3 =0
$$

Again we need to solve the system of equations created by the partial
derivated using the lgrange multipliers.

$$
\mathcal{L}(x_1,x_2,x_3) = \nabla f(x_1,x_2,x_3) + \lambda \nabla g(x_1,x_2,x_3)
$$

$$
\begin{cases}
4x_1 - 3x_2 + x_3 + \lambda = 0 \\
-3x_1 + 2x_2-2x_3 + \lambda = 0 \\
x_1 - 2x_2 + 6x_3 - \lambda = 0 \\
x_1 + x_2 - x_3 = 0
\end{cases}
$$

The steps toward the solution of this system of equations is the
following. From the third equation we have that
$\lambda = x_1-2x_2+6x_3$ and by place this in the first two equations
we have the following system of equations:

$$
\begin{cases}
5x_1-5x_2+7x_3=0 \\
-2x_1+4x_3=0 \\
x_1 + x_2 - x_3 = 0
\end{cases}
$$

With the help of the last equation we have that $x_3 = x_1 + x_2$ and by
placing this in the other two equations we have that $x_1 = -2x_2$ and
as a result, $x_3 = -x_2$. Show by combining all those findings with the
first equation we have that

$$
(x^*,x_2^*,x_3^*) = (0,0,0)
$$ Once again we are going to use the Hessian matrix to decide if this
point is maximum, minimum or saddle point. The Hessian Matrix is the

$$
H(x_1,x_2,x_3)=\begin{bmatrix}
4 & -3 & 1 \\
-3 & 2 & -2 \\
1 & -2 & 6 
\end{bmatrix}
$$ We observe that

$$
4>0
$$ $$
\begin{vmatrix}
4 & -3 \\
-3 & 2
\end{vmatrix} = 4\cdot2 - (-3)\cdot(-3)= 8 - 9 = -1 <0
$$

and finally

$$
\begin{vmatrix}
4 & -3 & 1 \\
-3 & 2 &-2 \\
1 & -2 & 6
\end{vmatrix} = 
$$ $$
4\cdot2\cdot6 + (-3)\cdot(-2)\cdot1 + 1(-3)\cdot(-2) - 1\cdot2\cdot1 -  (-2)\cdot(-2)\cdot4 -6\cdot(-3)\cdot(-3)
$$

$$
48 + 6 +6 - 2 -16 -54 = -12 < 0
$$

As we have seen, the Hessian matrix is negative definite and as a
result, we can say that the point $$
(x_1^*,x_2^*,x_3^*)=(0,0,0)
$$

is a maximum.

------------------------------------------------------------------------

### \underline{Exercise 4}:

Assume you have the following constrained problem:

$$
\begin{aligned}
& \text{maximize}
& & 6x_1 +4x_2 +7x_3 +5x_4 \\
& \text{subject to}
& & x_1 +2x_2 + x_3 +2x_4 \leq 20 \\
&&& 6x_1 +5x_2 +3x_3 +2x_4 \leq 100 \\
&&& 3x_1 +4x_2 +9x_3 +12x_4 \leq 75 \\
&&& x_1,x_2,x_3,x_4 \geq 0
\end{aligned}
$$

a.  Solve the problem (by using R-Programming Language)
b.  Write the dual problem and solve it as well.

### \underline{Solution}:

```{r}
f.obj <- c(6,4,7,5)
f.con <- matrix(c(1,2,1,2,6,5,3,2,3,4,9,12,1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1), nrow = 7, byrow = TRUE)
f.dir <- c("<=","<=","<=",">=",">=",">=",">=")
f.rhs <- c(20,100,75,0,0,0,0)

result <- lp("max",f.obj,f.con, f.dir,f.rhs)
```

The optimal solution $(x_1^*, x_2^*, x_3^*, x_4^*)$ :

```{r}
result$solution
```

and the optimal value for the objective function is :

```{r}
result$objval
```

Moving forward, the dual problem of the

$$
\begin{aligned}
& \text{maximize}
& & 6x_1 +4x_2 +7x_3 +5x_4 \\
& \text{subject to}
& & x_1 +2x_2 + x_3 +2x_4 \leq 20 \\
&&& 6x_1 +5x_2 +3x_3 +2x_4 \leq 100 \\
&&& 3x_1 +4x_2 +9x_3 +12x_4 \leq 75 \\
&&& x_1,x_2,x_3,x_4 \geq 0
\end{aligned}
$$ is the following

$$
\begin{aligned}
& \text{minimize}
& & 20y_1 + 100y_2 +75y_3 \\
& \text{subject to}
& & y_1 + 6y_2 + 3y_3  \geq 6 \\
&&& 2y_1 + 5y_2 + 4y_3 \geq 4 \\
&&& y_1 + 3y_2 + 9y_3 \geq 7 \\
&&& 2y_1 + 2y_2 + 12y_3 \geq 5 \\
&&& y_1,y_2,y_3 \geq 0
\end{aligned}
$$ 
In order to solve the dual problem we are going to follow the exact same steps as we did for the primal. Meaning,

```{r}
f.obj <- c(20,100,75)
f.con <- matrix(c(1,6,3,2,5,4,1,3,9,2,2,12,1,0,0,0,1,0,0,0,1), nrow = 7, byrow = TRUE)
f.dir <- c(">=",">=",">=",">=",">=",">=",">=")
f.rhs <- c(6,4,7,5,0,0,0)

result <- lp("min",f.obj,f.con, f.dir,f.rhs)
```

The optimal solution of the dual is the $(y_1^*, y_2^*, y_3^*)$ :

```{r}
result$solution
```

and the optimal value for the objective function is :

```{r}
result$objval
```

### \underline{Exercise 5}:

In order for Company AB to start production of two products, $P_1$ and
$P_2$, for the next quarter, is considering obtaining a loan from the
bank. Specifically, it deals with the problem of the amount of
production of the two products as well as the amount of the loan. The
purpose of the company is to maximize its total profits under the given
production, financing and market conditions. Production and sales
figures are given in the following table. The company also considers
that the market can contain two practically unlimited quantities of the
products at the selling prices shown in the table.

$$
\begin{tabular}{ |p{2cm}|p{2cm}|p{2cm}||p{2cm}|p{2cm}|p{2cm}|  } \hline
  Product & Price & Production Cost & \multicolumn{3}{|c|}{Wokring Hours per Sector} \\ \hline
  \multicolumn{3}{|c|}{} & 1 & 2 & 3\\ \hline
 \hline
  $P_1$ & 140 & 100 & 0.5 & 0.3 & 0.3 \\ \hline
  $P_2$ & 110 & 80 & 0.3 & 0.4 & 0.1 \\ \hline
  \multicolumn{3}{|c|}{Available Working Hours} & 1800 & 1000 & 700 \\ \hline
\end{tabular}
$$ $$
\textit{Production Plan's Data}
$$

In addition, the company must take into account the following data

1.  The company's available funds for the next quarter are €300,000.
2.  The bank grants a loan of up to €200,000 for three months with an
    interest rate of 5% per quarter, as long as the degree of immediate
    liquidity of the company, i.e. the ratio

$$
\frac{\text{Available Funds} + \text{Accounts Receivable}}{\text{Accounts Payable}}
$$

is at least 3 to 1 during the entire period in which the loan remains
outstanding. 3. Payments for wages and materials are made at the end of
the production period (the quarter) and therefore any credit needed is
secured at that point in time. The products are shipped on credit at the
end of the production period and finally the settlement of the accounts,
i.e. the revenue after the sale and the payments for the outstanding
liabilities are made at the end of the next period.

Formulate a linear programming model for the situation described above
and solve it computationally using R-programming language.

### \underline{Solution}:

AS we already know the company AB tries to maximize its profit so the
objective function of the problem is going to be

$$
max\quad \text{Profit}
$$

under some constraints. Before going to the analysis of the constraints,
we need to look a bit deeper in the term Profit. By definition, Profit
is defined as Income - Outcome. Let's assume that 

$$
\begin{aligned}
x_1 := \text{Number of Product 1 items produced}\\
x_2 := \text{Number of Product 2 items produced}
\end{aligned}
$$

Now we can write that as income, we are going to have all the items sold of the produced products times their price. So we can say that

$$
\text{Income} = x_1\cdot 140 + x_2\cdot 110
$$

On the other hand as Output we shall define all the money that company AB needs to pay in order to produce $x_1$ and $x_2$. We can see from the table provided above that the cost of production for one unit of $x_1$ and $x_2$ is 180 (100 for $x_1$ and 80 for $x_2$). The problem here is that in order to produce one unit of each product, apart form the money that needs to be spent, there is some amount of time needed. Initially, let us assume that:

$$
\begin{aligned}
w_ij := \text{Hours to be spent by sector } j \text{ to produce product } i\quad \forall\ i\in \{1,2\},\ j\in\{1,2,3\}
\end{aligned}
$$

If we take a quick look at the table above, we can see that in order to produce one unit of product $P_1$ we need

$$
x_1 = 0.5\cdot w_{11} + 0.3\cdot w_{12} + 0.3\cdot w_{13}
$$

and for $P_2$ we are going to need

$$
x_2 = 0.3\cdot w_{21} + 0.4\cdot w_{22} + 0.1\cdot w_{23}
$$

Though this may seem complete, we can also see that there is an upper bound for the hours a sector can be productive in the three month period that company considers as production period. We can describe this upper bound as

$$
\begin{aligned}
& w_{11} + w_{21} \leq 1800\\
& w_{12} + w_{22} \leq 1000\\
& w_{13} + w_{23} \leq 700 
\end{aligned}
$$

Combining all that information as well as the information given after the table we are going to end up in the following maximal problem

$$
\begin{aligned}
& \text{maximum}
& & 140x_1 + 110x_2 - (100x_1 + 80x_2)\\
& \text{subject to}
& & x_1 = 0.5w_{11} + 0.3w_{12} + 0.3w_{13}\\
&&& x_2 = 0.3w_{21} + 0.4w_{22} + 0.1w_{23}\\
&&& w_{11} + w_{21} \leq 1800\\
&&& w_{12} + w_{22} \leq 1000\\
&&& w_{13} + w_{23} \leq 700\\
&&& 3000 + 140x_1 + 110x_2 \geq 3(100x_1 + 80x_2)\\
&&& 100x_1 + 80x_2 \leq 500000 \\
&&& w_{ij} > 0 \quad \forall\ i,j
\end{aligned}
$$ 
and if we make all the calculations we have the following form of the maximization problem

$$
\begin{aligned}
& \text{maximum}
& & 20w_{11} + 12w_{12} + 12w_{13} + 9w_{21} + 12w_{22} + 3w_{23} - 210000\\
& \text{subject to}
&& w_{11} + w_{21} \leq 1800\\
&&& w_{12} + w_{22} \leq 1000\\
&&& w_{13} + w_{23} \leq 700\\
&&& 3000 -80w_{11} - 48w_{12} - 48w_{13} - 39w_{21} -52w_{22} - 13w_{23} \geq  0\\
&&& 50w_{11} + 30w_{12} + 30w_{13} + 24w_{21} + 32w_{22} + 8w_{23} \leq 500000 \\
&&& w_{ij} > 0 \quad \forall\ i,j
\end{aligned}
$$

```{r}
f.obj <- c(20,12,12,9,12,3)
f.con <- matrix(c(1,0,0,1,0,0,
                  0,1,0,0,1,0,
                  0,0,1,0,0,1,
                  1,1,1,1,1,1,
                  1,1,1,1,1,1,
                  1,0,0,0,0,0,
                  0,1,0,0,0,0,
                  0,0,1,0,0,0,
                  0,0,0,1,0,0,
                  0,0,0,0,1,0,
                  0,0,0,0,0,1), nrow = 11, byrow = TRUE)
f.dir <- c("<=","<=","<=",">=","<=",">",">",">",">",">",">")
f.rhs <- c(1800,1000,700,0,500000,0,0,0,0,0,0)

result <- lp("max",f.obj,f.con, f.dir,f.rhs)
```

The result that we are going to acquire from the constrained problem we created above is the amount that company is going to make. Don't forget that Company AB needs to repay the loan acquired from the bank, so in order to find the final profit we need to substract the loan + the interest (meaning 210000). With no further do, the maximum profit is acquired when working the following amount of hours (per sector)
```{r}
result$solution
```

As we can see it is not wise to produce product $P_2$. This strategy will give company the amount of
```{r}
result$objval
```

When giving the money back to the bank, company AB is left with

```{r}
result$objval-210000
```